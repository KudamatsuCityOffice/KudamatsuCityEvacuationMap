function loadShelters(data) {
  allMarkers.forEach(m => map.removeLayer(m));
  allMarkers = [];

  const showOpenOnly = document.getElementById('showOpenOnly').checked;
  const showPetsOnly = document.getElementById('showPetsOnly').checked;
  const showOstomateOnly = document.getElementById('showOstomateOnly').checked;
  const showWheelchairOnly = document.getElementById('showWheelchairOnly').checked;
  const showNursingRoomOnly = document.getElementById('showNursingRoomOnly').checked;

  data.forEach(rec => {
    const lat = parseFloat(rec.lat);
    const lng = parseFloat(rec.lng);
    const status = rec.status || '未開設';
    const name = rec.name;
    const note = rec.note || '';
    const evacuees = rec.evacuees || 0;
    const capacity = rec.capacity || 0;
    const icon = statusIcons[status] || statusIcons['未開設'];

    if (!lat || !lng) return;
    if (showOpenOnly && status !== '開設中') return;
    if (showPetsOnly && !note.includes('ペット受入可')) return;
    if (showOstomateOnly && !note.includes('オストメイト')) return;
    if (showWheelchairOnly && !note.includes('車椅子')) return;
    if (showNursingRoomOnly && !note.includes('授乳室')) return;

    const marker = L.marker([lat, lng], { icon }).addTo(map);
    allMarkers.push(marker);

    const congestionRate = (capacity > 0)
      ? Math.round((evacuees / capacity) * 100)
      : null;

    const popupHtml = `
      <strong>${name}</strong><br>
      開設状況：${status}<br>
      避難者数：${evacuees}人<br>
      収容人数：${capacity}人<br>
      ${congestionRate !== null ? `混雑率：${congestionRate}%<br>` : ''}
      備考：${note.replace(/\n/g, '<br>') || 'なし'}
    `;

    marker.bindPopup(popupHtml);
  });
}
